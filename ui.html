<style>
  body {
    margin: 0;
  }
  .hidden {
    visibility: hidden;
  }
  button {
    font-family: Inter, sans-serif;
    border: none;
    padding: 8px 16px;
    text-align: left;
    text-decoration: none;
    display: block;
    font-size: 16px;
    width: 100%;
    outline: none;
    cursor: pointer;
    transition: ease-in-out 75ms;
    border-bottom: 1px solid #eaeaea;
  }
  .enable {
    color: #000;
  }
  .enable:hover,
  .active {
    color: #1028ad !important;
  }
  .disable {
    color: #888;
  }
</style>

<button class="enable" value="ara">ğŸ‡¸ğŸ‡¦ Arabic</button>
<button class="enable" value="bul">ğŸ‡§ğŸ‡¬ Bulgarian</button>
<button class="enable" value="chs">ğŸ‡¨ğŸ‡³ Chinese (Simplified)</button>
<button class="enable" value="cht">ğŸ‡¨ğŸ‡³ Chinese (Traditional)</button>
<button class="enable" value="hrv">ğŸ‡­ğŸ‡· Croatian</button>
<button class="enable" value="cze">ğŸ‡¨ğŸ‡¿ Czech</button>
<button class="enable" value="dan">ğŸ‡©ğŸ‡° Danish</button>
<button class="enable" value="dut">ğŸ‡³ğŸ‡± Dutch</button>
<button class="enable" value="eng">ğŸ‡¬ğŸ‡§ English</button>
<button class="enable" value="fin">ğŸ‡«ğŸ‡® Finnish</button>
<button class="enable" value="fre">ğŸ‡«ğŸ‡· French</button>
<button class="enable" value="ger">ğŸ‡©ğŸ‡ª German</button>
<button class="enable" value="gre">ğŸ‡¬ğŸ‡· Greek</button>
<button class="enable" value="hun">ğŸ‡­ğŸ‡º Hungarian</button>
<button class="enable" value="kor">ğŸ‡°ğŸ‡· Korean</button>
<button class="enable" value="ita">ğŸ‡®ğŸ‡¹ Italian</button>
<button class="enable" value="jpn">ğŸ‡¯ğŸ‡µ Japanese</button>
<button class="enable" value="pol">ğŸ‡µğŸ‡± Polish</button>
<button class="enable" value="por">ğŸ‡µğŸ‡¹ Portuguese</button>
<button class="enable" value="rus">ğŸ‡·ğŸ‡º Russian</button>
<button class="enable" value="slv">ğŸ‡¸ğŸ‡® Slovenian</button>
<button class="enable" value="spa">ğŸ‡ªğŸ‡¸ Spanish</button>
<button class="enable" value="swe">ğŸ‡¸ğŸ‡ª Swedish</button>
<button class="enable" value="tur">ğŸ‡¹ğŸ‡· Turkish</button>

<script>
  let result = {};

  function disableButton(elem) {
    elem.classList.add("disable");
    elem.classList.remove("enable");
    elem.disabled = true;
  }

  async function recognize(image, language) {
    var formdata = new FormData();
    formdata.append("file", image);
    formdata.append("isOverlayRequired", "true");
    formdata.append("language", language);
    //formdata.append("scale", true);

    response = await fetch("https://api.ocr.space/parse/image", {
      method: "POST",
      headers: {
        apikey: "56b16152c688957",
      },
      body: formdata,
    });

    let timeout = setTimeout(() => {
      result.error = "Timeout. Try later";
      parent.postMessage({ pluginMessage: result }, "*");
    }, 10000);

    let result = await response.json();

    // clearTimeout(timeout);

    if (result.ErrorMessage != null) {
      result.error = result.ErrorMessage[0];
    } else if (result.ParsedResults[0].ParsedText == "") {
      result.error = "Text is not detected";
    }

    parent.postMessage({ pluginMessage: result }, "*");
  }

  onmessage = async (event) => {
    let file = new File([event.data.pluginMessage], "name.png");

    if (file.size < 1048576) {
      console.log(file.size / 1024 + " kb");
      let buttons = document.querySelectorAll("button");

      buttons.forEach((element) => {
        element.addEventListener("click", () => {
          recognize(file, element.value);

          buttons.forEach((e) => disableButton(e));

          element.classList.add("active");
          element.innerHTML = "ğŸ¤” Recognizing...";
        });
      });
    } else {
      result.error = "File too big";
      parent.postMessage({ pluginMessage: result }, "*");
    }
  };
</script>
